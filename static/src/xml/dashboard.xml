<templates>
    <!-- L1 Dashboard Page -->
    <t t-name="custom.dashboard" owl="1">
        <div class="dashboard-wrapper">
            <div class="dashboard-container d-flex gap-2 border-2 p-4 p-lg-5">
                <!-- Left section - card data -->
                <div class="cards w-33 d-flex flex-column gap-2" style="max-width: 33%;">
                    <div class="card">
                        <h3>
                            <t t-esc="state.main_data.sales?.order_count || 0" />
                        </h3>
                        <p>SALES ORDER</p>
                    </div>
                    <div class="card">
                        <h3>
                            <t t-esc="state.main_data.sales?.amount || 0" />
                        </h3>
                        <p>SALES</p>
                    </div>
                    <div class="card">
                        <h3>
                            <t t-esc="state.main_data.sales?.target || 0" />
                        </h3>
                        <p>SALES TARGET - Fixed (Year)</p>
                    </div>
                    <div class="card">
                        <h3>
                            <t t-esc="state.main_data.sales?.target_achievement || 0" />
                        </h3>
                        <p>TARGET-ACHIEVEMENT</p>
                    </div>
                    <div class="card">
                        <h3>
                            <t t-esc="state.main_data.revenue?.amount || 0" />
                        </h3>
                        <p>REVENUE Income</p>
                    </div>
                    <div class="card">
                        <h3>
                            <t t-esc="state.main_data.revenue?.cost_of_revenue || 0" />
                        </h3>
                        <p>COST OF REVENUE</p>
                    </div>
                    <div class="card">
                        <h3 class="bg-green">
                            <t t-esc="state.main_data.revenue?.gross_profit || 0" />
                        </h3>
                        <p>GROSS PROFIT</p>
                    </div>
                    <div class="card">
                        <h3 class="bg-green">
                            <t t-esc="state.main_data.revenue?.gross_profit_margin || 0" />
                        </h3>
                        <p>GROSS PROFIT MARGIN (%)</p>
                    </div>
                    <div class="card">
                        <h3>
                            <t t-esc="state.main_data.revenue?.expenses || 0" />
                        </h3>
                        <p>EXPENSES</p>
                    </div>
                    <div class="card">
                        <h3 class="bg-green">
                            <t t-esc="state.main_data.revenue?.net_profit || 0" />
                        </h3>
                        <p>NET PROFIT</p>
                    </div>
                    <div class="card">
                        <h3 class="bg-green">
                            <t t-esc="state.main_data.revenue?.net_profit_margin || 0" />
                        </h3>
                        <p>NET PROFIT MARGIN (%)</p>
                    </div>
                    <div class="card">
                        <h3>
                            <t t-esc="state.main_data.revenue?.accounts_receivable || 0" />
                        </h3>
                        <p>ACCOUNT RECEIVABLE</p>
                    </div>
                    <div class="card">
                        <h3>
                            <t t-esc="state.main_data.revenue?.accounts_payable || 0" />
                        </h3>
                        <p>ACCOUNT PAYABLE</p>
                    </div>
                </div>

                <!-- Right section - graphs -->
                <div class="graphs w-66 d-grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="graph-container">
                        <p>
                            <a href="/web#action=my_dashboard.action_l2_dashboard" class="graph_text" style="background-color: lightblue; text-decoration: none; display: inline-block; cursor: pointer;">
                                Sales</a>
                        </p>
                        <div class="graph" id="sales"></div>
                    </div>
                    <div class="graph-container">
                        <p>
                            <a href="/web#action=my_dashboard.action_l2_dashboard" class="graph_text" style="background-color: lightgreen; text-decoration: none; display: inline-block; cursor: pointer;">
                                Cash Flow</a>
                        </p>
                        <div class="graph" id="cash"></div>
                    </div>
                    <div class="graph-container">
                        <p>
                            <a href="/web#action=my_dashboard.action_l2_dashboard" class="graph_text" style="background-color: lightcoral; text-decoration: none; display: inline-block; cursor: pointer;">
                                Revenue</a>
                        </p>
                        <div class="graph" id="revenue"></div>
                    </div>
                    <div class="graph-container">
                        <p>
                            <a href="/web#action=my_dashboard.action_l2_dashboard" class="graph_text" style="background-color: orange; text-decoration: none; display: inline-block; cursor: pointer;">
                                Cost of Revenue</a>
                        </p>
                        <div class="graph" id="expenses"></div>
                    </div>
                </div>
            </div>
        </div>
    </t>

    <!-- HR Dashboard Page -->
    <t t-name="custom.hr_dashboard" owl="1">
        <div class="dashboard-wrapper">
            <!-- HR Graph Section -->
            <div class="mt-4 mb-4">
                <div class="dashboard-hr">
                    <div class="hr-card">
                        <p>
                            <span class="graph_text" style="background: #7a7aff;">Total Employee By Department</span>
                        </p>
                        <div class="hr-graph" id="department"></div>
                    </div>
                    <div class="hr-card">
                        <p>
                            <span class="graph_text" style="background: #7a7aff;">Total Employee By Gender</span>
                        </p>
                        <div class="hr-graph" id="gender"></div>
                    </div>
                    <div class="hr-card">
                        <p>
                            <span class="graph_text" style="background: #7a7aff;">Employee Count By Category</span>
                        </p>
                        <div class="hr-graph" id="category"></div>
                    </div>
                </div>
            </div>
        </div>
    </t>

    <!-- L2 Dashboard Page -->
    <t t-name="custom.l2_dashboard" owl="1">
        <div class="l2-dashboard-container">
        <!-- Loading -->
        <div t-if="state.isLoading" class="text-center my-5">
            <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading dashboard data...</p>
        </div>
    
        <!-- Content -->
        <div t-if="!state.isLoading" class="dashboard-content">
            <div class="alert alert-danger" t-if="state.error">
            <strong>Error:</strong>
            <t t-esc="state.errorMessage"/>
            </div>
    
            <div t-if="!state.error" class="dashboard-wrapper">
            <!-- ====================== Sales Overview ====================== -->
            <div class="row">
                <div class="card-header bg-l2 text-white w-100">
                <h5 class="card-title mb-0">
                    <i class="fa fa-chart-line me-2"/>
                    Sales Overview
                </h5>
                </div>
            </div>
    
            <div class="row">
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Total Sales</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="totalSalesChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
    
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Local Sales</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="localSalesChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
    
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Export Sales</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="exportSalesChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
            </div>
    
            <!-- ====================== Revenue Overview ====================== -->
            <div class="row">
                <div class="card-header bg-l2 text-white w-100">
                <h5 class="card-title mb-0">
                    <i class="fa fa-chart-line me-2"/>
                    Revenue Overview
                </h5>
                </div>
            </div>
    
            <div class="row">
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Total Revenue</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="totalRevenueChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
    
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Local Revenue</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="localRevenueChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
    
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Export Revenue</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="exportRevenueChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
            </div>
    
            <!-- ====================== Expenses Overview ====================== -->
            <div class="row">
                <div class="card-header bg-l2 text-white w-100">
                <h5 class="card-title mb-0">
                    <i class="fa fa-chart-line me-2"/>
                    Expenses Overview
                </h5>
                </div>
            </div>
    
            <div class="row">
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Total Expenses</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="totalExpensesChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
    
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Local Expenses</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="localExpensesChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
    
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Export Expenses</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="exportExpensesChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
            </div>
    
            <!-- ====================== CashFlow Overview ====================== -->
            <div class="row">
                <div class="card-header bg-l2 text-white w-100">
                <h5 class="card-title mb-0">
                    <i class="fa fa-chart-line me-2"/>
                    CashFlow Overview
                </h5>
                </div>
            </div>
    
            <div class="row">
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Total CashFlow</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="totalCashFlowChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
    
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Local CashFlow</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="localCashFlowChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
    
                <div class="col-md-4 mb-4 px-2">
                <div class="card shadow-sm h-100">
                    <div class="card-header">
                    <h5 class="card-title mb-0">Export CashFlow</h5>
                    </div>
                    <div class="card-body">
                    <div t-ref="exportCashFlowChart" class="chart-container" style="height: 300px;"></div>
                    </div>
                </div>
                </div>
            </div>
            <!-- ====================== /End ====================== -->
            </div>
        </div>
        </div>
    </t>

    <!-- L4 Dashboard Page -->
    <t t-name="custom.l4_dashboard" owl="1">
        <div class="dash l4-dashboard">
        <!-- Filters/Search -->
        <div class="dash__filters">
            <div class="input-group search" style="max-width: 520px;">
            <span class="input-group-text"><i class="fa fa-search"/></span>
            <input type="text" class="form-control" placeholder="Search by project or customer..."
                    t-on-input="(e) => this.handleSearch(e.target.value)" t-ref="searchInput"/>
            <button class="btn btn-outline-secondary" type="button"
                    t-on-click="() => this.clearSearch()" t-if="state.searchTerm">
                <i class="fa fa-times"/>
            </button>
            </div>
        </div>

        <!-- Card + Table -->
        <div class="card">
            <!-- Section header in brand blue -->
            <div class="card-header bg-l2 text-white">
            <h5 class="card-title mb-0">
                <i class="fa fa-chart-line me-2" />
                L4 Dashboard&nbsp; Project Delivery Report
            </h5>
            </div>

            <div class="table-wrap">
            <table class="dash-table" t-ref="table">
                <colgroup>
                <col class="col-sticky"/>
                <col class="col-project"/>
                <col class="col-customer"/>
                <col class="col-date"/>
                <col class="col-num"/><!-- PO Value -->
                <col class="col-num"/><!-- Invoiced -->
                <col class="col-num"/><!-- Collected -->
                <col class="col-num"/><!-- Pending Collection -->
                <col class="col-aging"/><!-- OS Aging -->
                <col class="col-num"/><!-- Vendor Invoice -->
                <col class="col-num"/><!-- Payment Made -->
                <col class="col-num"/><!-- Payment Pending -->
                <col class="col-num"/><!-- Payroll Cost -->
                <col class="col-num"/><!-- Total Outgoing -->
                <col class="col-num"/><!-- Total Margin -->
                <col class="col-num"/><!-- Margin % -->
                </colgroup>

                <!-- Make thead blue -->
                <thead class="thead-l2">
                <tr>
                    <th class="sticky-col">Region</th>
                    <th class="th-wrap">Project</th>
                    <th class="th-wrap">Customer</th>
                    <th class="th-wrap">Start Date</th>
                    <th class="th-wrap num">PO Value</th>
                    <th class="th-wrap num">Invoiced</th>
                    <th class="th-wrap num">Collected</th>
                    <th class="th-wrap num">Pending Collection</th>
                    <th class="th-wrap num aging">OS Aging</th>
                    <th class="th-wrap num">Vendor Invoice</th>
                    <th class="th-wrap num">Payment Made</th>
                    <th class="th-wrap num">Payment Pending</th>
                    <th class="th-wrap num">Payroll Cost</th>
                    <th class="th-wrap num">Total Outgoing</th>
                    <th class="th-wrap num">Total Margin</th>
                    <th class="th-wrap num">Margin %</th>
                </tr>
                </thead>

                <tbody>
                <t t-if="!this.state.main_data.projects">
                    <tr><td colspan="16" class="muted">No projects found matching the current filters</td></tr>
                </t>

                <t t-foreach="this.state.main_data.projects || []" t-as="row" t-key="row.project">
                    <tr class="project-row">
                    <td class="sticky-col">
                        <span t-att-class="row.region === 'Local' ? 'badge-info badge' : 'badge-success badge'">
                        <t t-esc="row.region"/>
                        </span>
                    </td>

                    <td class="col-project" t-att-data-project-id="row.id"
                        t-on-click="() => this.openProjectDetails(row.project_id)" style="cursor: pointer;">
                        <t t-set="projLines" t-value="this.splitProjectIntoLines(row.project)"/>
                        <t t-foreach="projLines" t-as="line" t-key="'proj-'+row.project+'-'+line_index">
                        <span class="proj-line" t-esc="line"/>
                        </t>
                    </td>

                    <td class="col-customer"><t t-esc="row.customer"/></td>
                    <td class="col-date"><t t-esc="row.date"/></td>

                    <td class="col-num"><t t-esc="this.fmt(row.po_value)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(row.invoiced)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(row.collected)"/></td>

                    <td class="col-num" t-att-class="row._raw_pending_collection &gt; 0 ? 'col-num text-danger' : 'col-num'">
                        <t t-esc="this.fmt(row.pending_collection)"/>
                    </td>

                    <td class="col-aging"><t t-esc="row.outstanding_aging"/></td>
                    <td class="col-num"><t t-esc="this.fmt(row.vendor_invoice)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(row.payment_made)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(row.payment_to_be_made)"/></td>
                    <td class="col-num text-danger"><t t-esc="this.fmt(row.payroll_cost)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(row.total_outgoing)"/></td>

                    <td class="col-num" t-att-class="row._raw_total_margin &lt; 0 ? 'col-num text-danger' : 'col-num text-success'">
                        <t t-esc="this.fmt(row.total_margin)"/>
                    </td>
                    <td class="col-num"
                        t-att-class="row._raw_margin_percent &lt; 0 ? 'col-num text-danger' : (row._raw_margin_percent &gt;= 20 ? 'col-num text-success' : 'col-num')">
                        <t t-esc="this.fmtPercent(row.margin_percent)"/>
                    </td>
                    </tr>
                </t>

                <!-- Totals -->
                <tr class="bg-accent fw-bold">
                    <td class="sticky-col text-start">Totals</td>
                    <td colspan="3"><t t-esc="this.state.main_data.summary.project_count"/></td>

                    <td class="col-num"><t t-esc="this.fmt(this.state.main_data.summary.total_po_value)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(this.state.main_data.summary.total_invoiced)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(this.state.main_data.summary.total_collected)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(this.state.main_data.summary.total_pending_collection)"/></td>

                    <td class="col-aging">0</td>

                    <td class="col-num"><t t-esc="this.fmt(this.state.main_data.summary.total_vendor_invoice)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(this.state.main_data.summary.total_payment_made)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(this.state.main_data.summary.total_payment_to_be_made)"/></td>
                    <td class="col-num text-danger"><t t-esc="this.fmt(this.state.main_data.summary.total_payroll_cost)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(this.state.main_data.summary.total_outgoing)"/></td>
                    <td class="col-num"><t t-esc="this.fmt(this.state.main_data.summary.total_margin)"/></td>
                    <td class="col-num"
                        t-att-class="this.state.main_data.summary._raw_avg_margin_percent &lt; 0 ? 'col-num text-danger' :
                                    (this.state.main_data.summary._raw_avg_margin_percent &gt;= 20 ? 'col-num text-success' : 'col-num')">
                    <t t-esc="this.fmtPercent(this.state.main_data.summary.avg_margin_percent)"/>
                    </td>
                </tr>
                </tbody>
            </table>
            </div>

            <div class="p-2 d-flex justify-content-between">
            <div class="muted small">
                <i class="fa fa-info-circle me-1"/> Click any project row for details
            </div>
            <div class="d-flex gap-3 small muted">
                <div><span class="badge badge-info me-1">Local</span> Local</div>
                <div><span class="badge badge-success me-1">Export</span> Export</div>
            </div>
            </div>
        </div>
        </div>
    </t>

    <!-- Dashboard Reports -->
    <t t-name="custom.druksmart_dashboard_reports" owl="1">
        <div class="dashboard-wrapper">
            <!-- Report Tabs -->
            <div class="d-flex justify-content-start align-items-center flex-wrap mb-3 gap-3">
                <div class="d-flex gap-2">
                    <t t-foreach="['sales', 'revenue', 'expense', 'cashflow']" t-as="tab" t-key="tab">
                        <button t-att-class="state.selectedCategory === tab ? 'btn btn-secondary' : 'btn btn-outline-secondary'" class="px-3 py-1 fw-bold" t-att-disabled="state.selectedCategory === tab" t-on-click="() => this.setCategory(tab)">
                            <t t-esc="tab === 'expense' ? 'VENDOR BILLS' : tab.toUpperCase()" />
                        </button>
                    </t>
                </div>
            </div>


            <t t-if="state.selectedCategory === 'cashflow'">
                <div class="mb-2 p-2 bg-primary text-white fw-bold rounded">CashFlow Report</div>

                <t t-set="groups" t-value="[
                    { label: 'INFLOW - LOCAL', data: state.main_data.cashflows.inflows.locals },
                    { label: 'INFLOW - EXPORT', data: state.main_data.cashflows.inflows.exports },
                    { label: 'OUTFLOW - LOCAL', data: state.main_data.cashflows.outflows.locals },
                    { label: 'OUTFLOW - EXPORT', data: state.main_data.cashflows.outflows.exports },
                ]"/>

                <t t-foreach="groups" t-as="section" t-key="section.label">
                    <div class="card shadow-sm mb-4">
                        <div
                            class="bg-light px-3 py-2 fw-bold text-uppercase border-top border-bottom d-flex justify-content-between align-items-center"
                            style="cursor: pointer"
                            t-on-click="() => this.toggleGroup(section.label)"
                        >
                            <span>
                                <i class="fa fa-caret-right me-1" t-if="!this.isGroupOpened(section.label)" />
                                <i class="fa fa-caret-down me-1" t-if="this.isGroupOpened(section.label)" />
                                <t t-esc="section.label" />
                            </span>
                            <span class="px-2 py-1 rounded bg-warning fw-bold">
                                TOTAL:
                                <t t-if="section.label === 'INFLOW - LOCAL'">
                                    <t t-esc="state.main_data.total_local_cashflow_inflow" />
                                </t>
                                <t t-elif="section.label === 'INFLOW - EXPORT'">
                                    <t t-esc="state.main_data.total_export_cashflow_inflow" />
                                </t>
                                <t t-elif="section.label === 'OUTFLOW - LOCAL'">
                                    <t t-esc="state.main_data.total_local_cashflow_outflow"/>
                                </t>
                                <t t-elif="section.label === 'OUTFLOW - EXPORT'">
                                    <t t-esc="state.main_data.total_export_cashflow_outflow" />
                                </t>
                            </span>
                        </div>

                        <t t-if="this.isGroupOpened(section.label)">
                            <div class="table-responsive">
                                <table class="table table-hover table-bordered mb-0 dashboard-table">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Date</th>
                                            <th>Inflow/Outflow</th>
                                            <th>Project</th>
                                            <th>Local/Export</th>
                                            <th>Tags</th>
                                            <th>Source Document</th>
                                            <th class="text-end">Payment Amount</th>
                                            <th class="text-end">Payment Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="section.data" t-as="row" t-key="row.id">
                                            <tr>
                                                <td><t t-esc="row.date" /></td>
                                                <td><t t-esc="row.inflow_outflow" /></td>
                                                <td><t t-esc="row.project" /></td>
                                                <td><t t-esc="row.local_export" /></td>
                                                <td><t t-esc="row.tags" /></td>
                                                <td><t t-esc="row.source_document" /></td>
                                                <td class="text-end"><t t-esc="row.payment_amount" /></td>
                                                <td class="text-end"><t t-esc="row.payment_status" /></td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </t>
                    </div>
                </t>
            </t>

            <t t-if="state.selectedCategory !== 'cashflow'">
                <t t-set="categories" t-value="['sales', 'revenue', 'expense']" />
                <t t-foreach="categories" t-as="cat" t-key="cat">
                    <t t-if="state.selectedCategory === cat">
                        <t t-set="groupedData" t-value="state.main_data['grouped_' + cat + 's']" />
                        <t t-set="title" t-value="cat === 'expense' ? 'Vendor Bills Report' : cat.charAt(0).toUpperCase() + cat.slice(1) + ' Report'" />

                        <div class="mb-2 p-2 bg-primary text-white fw-bold rounded d-flex justify-content-between align-items-center">
                            <span><t t-esc="title" /></span>
                            <div class="px-2 py-1 rounded bg-warning text-dark fw-bold">
                                TOTAL: 
                                <t t-if="state.selectedCategory === 'sales'">
                                    <t t-esc="state.main_data.total_sales_untaxed" />
                                </t>
                                <t t-if="state.selectedCategory === 'revenue'">
                                    <t t-esc="state.main_data.total_revenue_untaxed" />
                                </t>
                                <t t-if="state.selectedCategory === 'expense'">
                                    <t t-esc="state.main_data.total_expense_untaxed" />
                                </t>
                            </div>
                        </div>

                        <div class="card shadow-sm">
                            <div class="table-responsive">
                                <t t-if="Object.keys(groupedData || {}).length === 0">
                                    <div class="text-center py-4 text-muted">
                                        <i class="fa fa-info-circle me-1" />
                                No data available
                                    </div>
                                </t>

                                <t t-foreach="Object.entries(groupedData || {})" t-as="group" t-key="group[0]">
                                    <div class="bg-light px-3 py-2 fw-bold text-uppercase border-top border-bottom d-flex justify-content-between align-items-center" style="cursor: pointer" t-on-click="() => this.toggleGroup(group[0])">
                                        <span>
                                            <i class="fa fa-caret-right me-1" t-if="!this.isGroupOpened(group[0])" />
                                            <i class="fa fa-caret-down me-1" t-if="this.isGroupOpened(group[0])" />
                                            <t t-esc="group[0]" />
                                        </span>
                                        <span class="px-2 py-1 rounded bg-warning fw-bold">
                                            TOTAL UNTAXED:
                                            <t t-if="cat === 'sales'">
                                                <t t-esc="state.main_data['total_sales_' + group[0].toLowerCase() + '_untaxed' + '_not_converted'] || '--'" />
                                            </t>
                                            <t t-elif="cat === 'revenue'">
                                                <t t-esc="state.main_data['total_revenue_' + group[0].toLowerCase() + '_untaxed' + '_not_converted'] || '--'" />
                                            </t>
                                            <t t-elif="cat === 'expense'">
                                                <t t-esc="state.main_data['total_expense_' + group[0].toLowerCase() + '_untaxed' + '_not_converted'] || '--'" />
                                            </t>
                                            TOTAL:
                                            <t t-if="cat === 'sales'">
                                                <t t-esc="state.main_data['total_sales_' + group[0].toLowerCase() + '_untaxed'] || '--'" />
                                            </t>
                                            <t t-elif="cat === 'revenue'">
                                                <t t-esc="state.main_data['total_revenue_' + group[0].toLowerCase() + '_untaxed'] || '--'" />
                                            </t>
                                            <t t-elif="cat === 'expense'">
                                                <t t-esc="state.main_data['total_expense_' + group[0].toLowerCase() + '_untaxed'] || '--'" />
                                            </t>
                                        </span>
                                        
                                    </div>

                                    <t t-if="this.isGroupOpened(group[0])">
                                        <table class="table table-striped table-hover mb-0 dashboard-table border-bottom">
                                            <thead>
                                                <tr class="bg-light">
                                                    <t t-if="cat === 'sales'">
                                                        <th>Date</th>
                                                        <th>Sale Order No</th>
                                                        <th>Tags</th>
                                                        <th>Customer</th>
                                                        <th>Sale Person</th>
                                                        <th class="text-end">Untaxed Amount</th>
                                                        <th class="text-end">Converted Amount</th>
                                                    </t>
                                                    <t t-if="cat === 'revenue'">
                                                        <th>Date</th>
                                                        <th>Invoice No</th>
                                                        <th>Sale Order No</th>
                                                        <th>Local/Export</th>
                                                        <th>Tags</th>
                                                        <th>Customer</th>
                                                        <th class="text-end">Untaxed Amount</th>
                                                        <th class="text-end">Payment Status</th>
                                                    </t>
                                                    <t t-if="cat === 'expense'">
                                                        <th>Date</th>
                                                        <th>Bill No</th>
                                                        <th>Vendor</th>
                                                        <th>Local/Export</th>
                                                        <th>Tags</th>
                                                        <th>Source Document</th>
                                                        <th class="text-end">Tax Excluded</th>
                                                        <th class="text-end">Payment Status</th>
                                                    </t>
                                                    <!-- <t t-if="cat === 'cashflow'">
                            <th>Date</th>
                            <th>Inflow/Outflow</th>
                            <th>Project</th>
                            <th>Local/Export</th>
                            <th>Tags</th>
                            <th>Source Document</th>
                            <th class="text-end">Payment Amount</th>
                            <th class="text-end">Payment Status</th>
                            </t> -->
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="group[1]" t-as="row" t-key="row.id">
                                                    <tr>
                                                        <t t-if="cat === 'sales'">
                                                            <td>
                                                                <t t-esc="row.date" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.sales_order_no" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.tags" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.customer" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.sale_person" />
                                                            </td>
                                                            <td class="text-end">
                                                                <t t-esc="row.untaxed_amount" />
                                                            </td>
                                                            <td class="text-end">
                                                                <t t-esc="row.converted_amount" />
                                                            </td>
                                                        </t>
                                                        <t t-if="cat === 'revenue'">
                                                            <td>
                                                                <t t-esc="row.date" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.invoice_no" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.sales_order_no" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.local_export" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.tags" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.customer" />
                                                            </td>
                                                            <td class="text-end">
                                                                <t t-esc="row.untaxed_amount" />
                                                            </td>
                                                            <td class="text-end">
                                                                <t t-esc="row.payment_status" />
                                                            </td>
                                                        </t>
                                                        <t t-if="cat === 'expense'">
                                                            <td>
                                                                <t t-esc="row.date" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.bill_no" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.vendor" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.local_export" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.tags" />
                                                            </td>
                                                            <td>
                                                                <t t-esc="row.source_document" />
                                                            </td>
                                                            <td class="text-end">
                                                                <t t-esc="row.tax_excluded" />
                                                            </td>
                                                            <td class="text-end">
                                                                <t t-esc="row.payment_status" />
                                                            </td>
                                                        </t>
                                                        <!-- <t t-if="cat === 'cashflow'">
                                <td><t t-esc="row.date" /></td>
                                <td><t t-esc="row.inflow_outflow" /></td>
                                <td><t t-esc="row.project" /></td>
                                <td><t t-esc="row.local_export" /></td>
                                <td><t t-esc="row.tags" /></td>
                                <td><t t-esc="row.source_document" /></td>
                                <td class="text-end"><t t-esc="row.payment_amount" /></td>
                                <td class="text-end"><t t-esc="row.payment_status" /></td>
                            </t> -->
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </t>
                                </t>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </div>
    </t>
</templates>
